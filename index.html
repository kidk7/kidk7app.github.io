<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>yum.chive</title>
<style>
  /* ì „ì²´ ê¸°ë³¸ ë° ë ˆì´ì•„ì›ƒ */
  * { box-sizing: border-box; }
  html, body { margin:0; padding:0; width:100%; }
  body {
    font-family: 'Arial', sans-serif;
    background: #fffbe7;
    color: #4e3900;
    font-size: 16px;
    margin: 0;
    padding-bottom: 62px; /* í•˜ë‹¨ ë‚´ë¹„ ë°” ê³µê°„ í™•ë³´ */
    min-height:100vh;
  }
  a {text-decoration: none; color: inherit;}

  /* ìƒë‹¨ ë°” */
  header.app-header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 56px;
    background: #ffda3c;
    border-bottom: 2px solid #ecc700;
    display: flex;
    align-items: center;
    padding: 0 16px;
    z-index: 1100;
    box-shadow: 0 2px 8px rgba(255,218,60,0.15);
  }
  #logo {
    height: 34px;
    width: 108px;
    background: #fffde8;
    border: 1.8px solid #e7be17;
    border-radius: 7px;
    object-fit: contain;
    flex-shrink: 0;
  }
  #appTitle {
    margin-left: 18px;
    font-weight: bold;
    font-size: 1.32rem;
    flex-grow: 1;
    text-align: left;
    color: #4e3900;
    user-select:none;
  }

  /* ë©”ì¸ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ */
  main#appContent {
    padding: 70px 8px 88px;
    max-width: 500px;
    margin: 0 auto;
  }

  /* í•„í„° í† ê¸€ ë²„íŠ¼ */
  #filterToggleBtn {
    display: block;
    width: 100%;
    background: #ffe065;
    border: none;
    border-radius: 19px;
    padding: 16px 0 15px 0;
    font-weight: bold;
    font-size: 1.15rem;
    color: #856300;
    cursor: pointer;
    margin-bottom: 18px;
    margin-top:0;
    user-select:none;
    box-shadow: 0 2.5px 10px rgba(250,193,58,0.28);
    letter-spacing: 0.04em;
  }
  #filterToggleBtn.active {
    background: #d5ad00;
    color: #fff;
  }

  /* í•„í„° íŒ¨ë„ ì˜¤ë²„ë ˆì´ */
  #filterOverlay {
    position:fixed; z-index:1510; left:0; top:0; right:0; bottom:0;
    background:rgba(0,0,0,0.33);
    display:none;
    align-items:center; justify-content:center;
    padding:0;
  }
  #filterOverlay.active {display:flex;}
  section#filters {
    background: #fff0a0;
    border-radius: 22px;
    padding: 22px 14px 20px 14px;
    min-width:260px; max-width:390px;
    box-shadow: 0 4px 28px rgba(255, 215, 0, 0.31);
    margin: 0 20px; position:relative;
    overflow: visible;
    display:block;
    animation: filterdrop .2s cubic-bezier(.54,1.6,.52,1.05);
  }
  @keyframes filterdrop {
    0% { transform: translateY(-40px); opacity:0; }
    100% { transform: translateY(0); opacity:1; }
  }
  section#filters .filter-group {
    margin-bottom: 18px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  section#filters .filter-group:last-child { margin-bottom: 0; }
  section#filters .filter-label {
    font-weight: 800;
    color: #856300;
    user-select:none;
    width: 72px;
    font-size:1.05em;
  }
  section#filters .filter-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    width:calc(100% - 75px);
  }
  section#filters .filter-buttons button {
    flex: 1 1 88px;
    min-width:88px; max-width:130px;
    padding: 10px 10px;
    font-size: 1.05em;
    border: none;
    border-radius: 13px;
    cursor: pointer;
    background-color: #ffe065;
    font-weight: bold;
    color: #856300;
    white-space: nowrap;
    box-shadow: 0 1.5px 6px rgba(0,0,0,0.08);
    margin-bottom:2px;
    margin-top:2px;
    transition: background-color 0.23s, color 0.23s;
    letter-spacing:0.01em;
  }
  section#filters .filter-buttons button.active {
    background-color: #d5ad00;
    color: #fff;
  }
  button#clearFilters {
    background: #d5ad00;
    color: #fff;
    border: none;
    border-radius: 14px;
    font-weight: 800;
    padding: 14px 0 13px 0;
    width: 100%;
    cursor: pointer;
    font-size: 1.08em;
    margin-top: 19px;
    box-shadow: 0 3px 9px rgba(210,173,0,0.59);
    transition: background 0.2s;
    user-select:none;
  }
  button#clearFilters:active {background:#be9306;}

  button.filterCloseBtn {
    position:absolute;
    right:8px; top:7px;
    border:none; background:none; color:#947601;
    font-size:2.3em; font-weight:bold; outline:none;
    width:34px; height:34px; border-radius:50%; line-height:1;
    cursor:pointer; z-index:20;
    transition: background .2s;
  }
  button.filterCloseBtn:active {background:#ffe598;}
  

  /* ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
  ul.restaurant-list {
    list-style: none;
    padding: 0; margin: 0;
    width:100%;
  }
  ul.restaurant-list li.card {
    background: #fffde8;
    border-radius: 19px;
    box-shadow: 0 3px 17px rgba(250,193,58,0.18);
    display: flex;
    gap: 18px;
    padding: 18px 18px 16px 13px;
    margin: 20px 0 0 0;
    cursor: pointer;
    align-items: center;
    transition: box-shadow 0.18s;
    min-height:109px;
  }
  ul.restaurant-list li.card:hover,
  ul.restaurant-list li.card:focus-visible {
    box-shadow: 0 8px 20px rgba(250,193,58,0.31);
    outline: none;
  }
  .card img.thumb {
    flex-shrink: 0;
    width: 90px; height: 90px;
    border-radius: 13px;
    object-fit: cover;
    background:#f2e9b7;
  }
  .card .info {
    flex-grow: 1;
  }
  .card .info h3 {
    margin: 0 0 7px 0;
    font-size: 1.23em;
    font-weight: 900;
    color: #856300;
    letter-spacing: -0.01em;
  }
  .card .info p {
    margin: 1.5px 0;
    font-size: 1.01em;
    color: #645400;
    line-height: 1.3;
    font-weight: 500;
  }

  /* í˜ì´ì§€ë„¤ì´ì…˜ */
  .pagination {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin: 26px 0 10px 0;
    align-items: center;
  }
  .pagination button {
    background: #ffe065;
    color: #856301;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1.07em;
    padding: 7px 15px;
    cursor: pointer;
    transition: background 0.18s, color 0.18s;
  }
  .pagination button.active, .pagination button:focus {
    background: #d5ad00;
    color: #fff;
    outline:none;
  }

  /* ìƒì„¸ ì˜¤ë²„ë ˆì´ */
  #detailOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1530;
    padding: 16px;
    text-align:left;
  }
  #detailOverlay.active { display: flex; }
  #detailCard {
    background: #fffde8;
    border-radius: 18px;
    max-width: 410px;
    width: 100%;
    padding: 24px 20px 20px 20px;
    box-shadow: 0 6px 32px rgba(250,193,58,0.37);
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }
  #detailCard h2 {
    margin-top: 0; margin-bottom:4px;
    font-size: 1.32rem;
    font-weight: 800;
    color: #856300;
    text-align: left;
  }
  #detailCard img {
    display: block;
    margin: 16px auto 6px auto;
    width: 92%;
    max-height: 189px;
    object-fit: cover;
    border-radius: 12px;
    background:#f3edbe;
  }
  #detailCard p {
    font-size: 1.06em;
    line-height: 1.52;
    margin: 8px 0 7px 0;
    color: #654920;
    word-break:keep-all;
  }
  #detailCard .closeBtn {
    position: absolute;
    top: 13px; right: 15px;
    background: #d5ad00;
    border: none;
    color: #fff;
    font-weight: 900;
    font-size: 22px;
    width: 39px; height: 39px;
    border-radius: 50%;
    cursor: pointer;
    line-height: 1;
    z-index:31;
  }
  #detailCard .closeBtn:active {background:#9e8207;}

  /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
  nav.app-nav {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 66px;
    background: #ffda3c;
    border-top: 2px solid #ecc700;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -2px 12px rgba(255,218,60,0.18);
    z-index: 1600;
  }
  nav.app-nav button {
    background: none;
    border: none;
    color: #4e3900;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    flex-grow: 1;
    padding: 11px 3px 9px;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
    transition: color 0.24s;
  }
  nav.app-nav button.active {
    color: #d5ad00;
  }
  nav.app-nav button span.icon {
    font-size: 27px;
    margin-bottom: 2px;
    line-height: 1;
    filter: drop-shadow(0 1.5px 1.4px #fff48879);
  }
</style>
</head>
<body>
<header class="app-header">
  <img id="logo" src="https://www.konkuk.ac.kr/sites/konkuk/images/common/logo-top-color.png" alt="ê±´êµ­ëŒ€í•™êµ ë¡œê³ " />
  <div id="appTitle">yum.chive</div>
</header>

<main id="appContent" role="main" tabindex="-1">

  <!-- í•„í„° í† ê¸€ ë²„íŠ¼ -->
  <button id="filterToggleBtn" aria-expanded="false" aria-controls="filters" aria-label="í•„í„° ì—´ê¸°">í•„í„°</button>

  <!-- í•„í„° ì˜¤ë²„ë ˆì´ -->
  <div id="filterOverlay">
    <section id="filters" aria-label="ë§›ì§‘ í•„í„°">
      <button class="filterCloseBtn" aria-label="í•„í„° ë‹«ê¸°">&times;</button>
      <div class="filter-group">
        <div class="filter-label">ìœ„ì¹˜</div>
        <div class="filter-buttons" id="filterRegion"></div>
      </div>
      <div class="filter-group">
        <div class="filter-label">ê¸°í˜¸</div>
        <div class="filter-buttons" id="filterTag"></div>
      </div>
      <div class="filter-group">
        <div class="filter-label">ê°€ê²©</div>
        <div class="filter-buttons" id="filterPrice"></div>
      </div>
      <button type="button" id="clearFilters" aria-label="í•„í„° ì´ˆê¸°í™”">í•„í„° ì´ˆê¸°í™”</button>
    </section>
  </div>

  <!-- ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ -->
  <ul class="restaurant-list" id="restaurantList" aria-live="polite" aria-relevant="additions"></ul>
  <div class="pagination" id="pagination"></div>
</main>

<!-- ìƒì„¸ ì˜¤ë²„ë ˆì´ -->
<div id="detailOverlay" role="dialog" aria-modal="true" aria-labelledby="detailTitle">
  <div id="detailCard" tabindex="0">
    <button class="closeBtn" aria-label="ìƒì„¸ ì •ë³´ ë‹«ê¸°">&times;</button>
    <h2 id="detailTitle"></h2>
    <img alt="" id="detailImage" />
    <p id="detailDescription"></p>
    <p id="detailLocation"></p>
    <p id="detailTags"></p>
    <p id="detailExtra"></p>
  </div>
</div>

<!-- í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ -->
<nav class="app-nav" aria-label="ì£¼ìš” ë©”ë‰´">
  <button type="button" id="navHome" class="active" aria-current="page">
    <span class="icon">ğŸ </span>í™ˆ
  </button>
  <button type="button" id="navCommunity">
    <span class="icon">ğŸ’¬</span>ì»¤ë®¤ë‹ˆí‹°
  </button>
  <button type="button" id="navRanking">
    <span class="icon">ğŸ†</span>ë­í‚¹
  </button>
  <button type="button" id="navNotice">
    <span class="icon">ğŸ“¢</span>ê³µì§€
  </button>
</nav>

<script>
const WHITE_IMG = "https://via.placeholder.com/90x90/FFFFFF/FFFFFF?text=+";
const data = {
  "ê±´ëŒ€ì…êµ¬": [
    {name:"ì†¡í™”ì‚°ì‹œë„ì‚­ë©´",menu:"ë¹„ë¹”ë°¥",addr:"ì„œìš¸ ê´‘ì§„êµ¬ í™”ì–‘ë™ 123-10",type:"í•œì‹",img:"https://ldb-phinf.pstatic.net/20171222_273/1513909993152wbpV8_JPEG/fM-4sk2LkYUe0jmd83plu51X.JPG.jpg",tags:["vegan"]},
    {name:"ì •ë©´ ê±´ëŒ€",menu:"ìš°ë™",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ìì–‘ë™ 456-5",type:"ì¼ì‹",img:"https://ldb-phinf.pstatic.net/20221105_150/1667640635518fdmMX_JPEG/01_%25BE%25D7%25BC%25C7%25C4%25C6-6.jpg",tags:[]},
    {name:"ëª¨ì¸ ì»¤í”¼ ê±´ëŒ€",menu:"ì´ˆë°¥",addr:"ì„œìš¸ ê´‘ì§„êµ¬ í™”ì–‘ë™ 78-3",type:"ì¼ì‹Â·ì¹´í˜",img:"https://ldb-phinf.pstatic.net/20240910_185/1725956101822qU4L5_JPEG/KakaoTalk_Photo_2023-01-31-13-38-33.jpeg",tags:["vegan","under10k"]},
    {name:"í•˜ì´ë””ë¼ì˜¤ ê±´ëŒ€ì ",menu:"ë‹­í•œë§ˆë¦¬",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ìì–‘ë™ 9-7",type:"ì¤‘ì‹",img:"https://naverbooking-phinf.pstatic.net/20231025_91/1698209935312gkRt7_JPEG/%25CB%25EF%25D3%25DE%25EF%25C1.jpg",tags:["halal"]},
    {name:"ìš°ë§ˆì´ë„ ê±´ëŒ€ì ",menu:"ê¹Œë¥´ë³´ë‚˜ë¼",addr:"ì„œìš¸ ê´‘ì§„êµ¬ êµ°ìì—­ë¡œ 6-8",type:"ì–‘ì‹",img:"https://ldb-phinf.pstatic.net/20250508_188/1746671048632zEGis_PNG/1000058982.png",tags:[]},
    {name:"ë¯¸ë¶„ë‹¹ ê±´ëŒ€",menu:"ìŠ¤í…Œì´í¬",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ëŠ¥ë™ë¡œ 20-11",type:"ì–‘ì‹",img:"https://ldb-phinf.pstatic.net/20240312_21/1710250327869PUFrG_JPEG/IMG_0124.jpeg",tags:["glutenfree"]},
    {name:"ê³„íƒ„ì§‘",menu:"ì§¬ë½•",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì–´ë¦°ì´ëŒ€ê³µì›ë¡œ 11-4",type:"ì¤‘ì‹",img:"https://pup-review-phinf.pstatic.net/MjAyNTA4MDNfMzYg/MDAxNzU0MjA5MDM4NjA0.JPEG/1000061462.jpg",tags:[]},
    {name:"í•µë°¥ ê±´ëŒ€ì ",menu:"ëˆì¹´ì¸ ",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ê±´êµ­ëŒ€ë¡œ 15-2",type:"ì¼ì‹",img:"https://ldb-phinf.pstatic.net/20250424_271/1745462663087VrIBz_JPEG/14.jpg",tags:["vegan","under10k"]},
    {name:"ê³ ë² ê·œì¹´ì¸  ê±´ëŒ€ë³¸ì ",menu:"ë¹„ë¹”ë°¥",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ìì–‘ë¡œ 122-6",type:"í•œì‹",img:"https://ldb-phinf.pstatic.net/20230329_272/1680084605093YCtTI_JPEG/KakaoTalk_20230329_174932601_04.jpg",tags:[]}
  ],
  "ì¤‘ë¬¸": [
    {name:"ë‘ì°œ ê±´ëŒ€ì ",menu:"ì°œë‹­",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì¤‘ê³¡ë™ 12-3",type:"í•œì‹",img:WHITE_IMG,tags:[]},
    {name:"ì •ë©´ êµ­ìˆ˜",menu:"êµ­ìˆ˜",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì¤‘ê³¡ë™ 8-9",type:"í•œì‹",img:WHITE_IMG,tags:[]},
    {name:"ë‚´ê°€ì°œí•œë‹­ ê±´êµ­ëŒ€ì ",menu:"ë‹­ê°ˆë¹„",addr:"ì„œìš¸ ê´‘ì§„êµ¬ êµ°ìë™ 14-1",type:"í•œì‹",img:WHITE_IMG,tags:[]}
  ],
  "í›„ë¬¸": [
    {name:"ì‹œí™ì“° ê±´ëŒ€",menu:"ë³¶ìŒë°¥",addr:"ì„œìš¸ ê´‘ì§„êµ¬ í›„ë¬¸ë¡œ 112-5",type:"ì¤‘ì‹",img:"https://ldb-phinf.pstatic.net/20220712_282/16576252274583ilfO_JPEG/2AA67F98-63C8-482B-A6B3-7E3DAD363062.jpeg",tags:[]},
    {name:"ìƒˆë¡œì´ ê±´ëŒ€",menu:"ë²„ê±°",addr:"ì„œìš¸ ê´‘ì§„êµ¬ í›„ë¬¸ë¡œ 130-2",type:"ë²„ê±°ë¥˜",img:WHITE_IMG,tags:[]},
    {name:"ë˜ë¹—í™€ ë²„ê±°ì»´í¼ë‹ˆ ê±´ëŒ€",menu:"í•¸ë“œë©”ì´ë“œ ë²„ê±°",addr:"ì„œìš¸ ê´‘ì§„êµ¬ í›„ë¬¸ê¸¸ 18-7",type:"ë²„ê±°ë¥˜",img:WHITE_IMG,tags:["under10k"]}
  ],
  "ì–´ë¦°ì´ëŒ€ê³µì›": [
    {name:"ì—ì´ë¿”ë¨ êµ°ìì ",menu:"ì–‘ê³ ê¸°êµ¬ì´",addr:"ì„œìš¸ ê´‘ì§„êµ¬ êµ°ìë™ 50-1",type:"ì–‘ì‹",img:WHITE_IMG,tags:[]},
    {name:"ìˆ˜í¼ìŠ¬ë¼ì´ë”ìŠ¤",menu:"ë²„ê±°",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì–´ë¦°ì´ëŒ€ê³µì›ë¡œ 15-6",type:"ë²„ê±°ë¥˜",img:WHITE_IMG,tags:["under10k"]},
    {name:"í˜¼ë‹¤ë¼ë©˜",menu:"ë¼ë©˜",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ìì–‘ë™ 20-4",type:"ì¼ì‹",img:WHITE_IMG,tags:[]},
    {name:"ì´ˆë¼ë©˜",menu:"ë¼ë©˜",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì–´ë¦°ì´ëŒ€ê³µì›ë¡œ 22-8",type:"ì¼ì‹",img:WHITE_IMG,tags:["glutenfree"]},
    {name:"ê¾¸ì•„ ê±´ëŒ€ì ",menu:"ë² íŠ¸ë‚¨ ìŒ€êµ­ìˆ˜",addr:"ì„œìš¸ ê´‘ì§„êµ¬ ê´‘ì§„ë¡œ 88-9",type:"ì•„ì‹œì•„ì‹",img:WHITE_IMG,tags:["vegan"]},
    {name:"ì˜¤ë§ˆì¹´ì„¸ ì˜¤ì‚¬ì´ì´ˆë°¥ ê±´ëŒ€ë³¸ì ",menu:"ì´ˆë°¥",addr:"ì„œìš¸ ê´‘ì§„êµ¬ êµ°ìì—­ë¡œ 77-12",type:"ì¼ì‹",img:WHITE_IMG,tags:[]}
  ]
};

let currentView = "home";
let currentCategory = "";
let currentDietTags = [];
let currentPrice = "";
let restaurantClicks = JSON.parse(localStorage.getItem('restaurantClicks') || '{}');
let currentPage = 1;

// ìš”ì†Œ ì°¸ì¡°
const filterToggleBtn = document.getElementById('filterToggleBtn');
const filterOverlay = document.getElementById('filterOverlay');
const filtersSection = document.getElementById('filters');
const filterRegionEl = document.getElementById('filterRegion');
const filterTagEl = document.getElementById('filterTag');
const filterPriceEl = document.getElementById('filterPrice');
const clearFiltersBtn = document.getElementById('clearFilters');
const filterCloseBtn = filtersSection.querySelector('.filterCloseBtn');

const restaurantListEl = document.getElementById('restaurantList');
const paginationEl = document.getElementById('pagination');
const detailOverlay = document.getElementById('detailOverlay');
const detailCard = document.getElementById('detailCard');
const detailTitle = document.getElementById('detailTitle');
const detailImage = document.getElementById('detailImage');
const detailDescription = document.getElementById('detailDescription');
const detailLocation = document.getElementById('detailLocation');
const detailTags = document.getElementById('detailTags');
const detailExtra = document.getElementById('detailExtra');
const detailCloseBtn = detailCard.querySelector('.closeBtn');
const navButtons = {
  home: document.getElementById('navHome'),
  community: document.getElementById('navCommunity'),
  ranking: document.getElementById('navRanking'),
  notice: document.getElementById('navNotice'),
};

const regions = ["ê±´ëŒ€ì…êµ¬", "ì¤‘ë¬¸", "í›„ë¬¸", "ì–´ë¦°ì´ëŒ€ê³µì›"];
const dietTags = ["vegan", "halal", "glutenfree", "allergy"];
const priceRanges = [
  { key: "under7k", label: "7,000ì› ì´í•˜" },
  { key: "under14k", label: "14,000ì› ì´í•˜" },
  { key: "under20k", label: "20,000ì› ì´í•˜" },
  { key: "over20k", label: "20,000ì› ì´ìƒ" }
];

// í•„í„° ì œì–´
function createFilterButtons(container, options, activeList, onClickCallback) {
  container.innerHTML = "";
  options.forEach(opt => {
    let key, label;
    if (typeof opt === "string") { key = label = opt; }
    else { key = opt.key; label = opt.label; }
    const btn = document.createElement('button');
    btn.textContent = label;
    btn.dataset.key = key;
    btn.type = "button";
    btn.classList.add('filterBtn');
    if (activeList.includes(key)) btn.classList.add('active');
    btn.onclick = () => onClickCallback(key, btn);
    container.appendChild(btn);
  });
}
function onRegionClick(key, btn) {
  currentCategory = (currentCategory === key) ? "" : key;
  updateFilterButtons();
  renderRestaurantList();
}
function onDietClick(key, btn) {
  if (currentDietTags.includes(key)) {
    currentDietTags = currentDietTags.filter(v => v !== key);
    btn.classList.remove('active');
  } else {
    currentDietTags.push(key);
    btn.classList.add('active');
  }
  renderRestaurantList();
}
function onPriceClick(key, btn) {
  if (currentPrice === key) {
    currentPrice = "";
    btn.classList.remove('active');
  } else {
    currentPrice = key;
    Array.from(btn.parentElement.children).forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }
  renderRestaurantList();
}
function updateFilterButtons() {
  Array.from(filterRegionEl.children).forEach(btn => {
    if (btn.dataset.key === currentCategory) btn.classList.add('active');
    else btn.classList.remove('active');
  });
}
clearFiltersBtn.onclick = () => {
  currentCategory = "";
  currentDietTags = [];
  currentPrice = "";
  updateFilterButtons();
  createFilterButtons(filterTagEl, dietTags, [], onDietClick);
  createFilterButtons(filterPriceEl, priceRanges, [], onPriceClick);
  renderRestaurantList();
};
// í•„í„° íŒ¨ë„ ì œì–´
filterToggleBtn.onclick = () => {
  if (detailOverlay.classList.contains('active')) return; // ìƒì„¸ì˜¤ë²„ë ˆì´ ìš°ì„ 
  filterOverlay.classList.add('active');
  filterToggleBtn.classList.add('active');
  filterToggleBtn.setAttribute('aria-expanded', 'true');
  document.body.style.overflow="hidden";
}
filterCloseBtn.onclick = () => {
  filterOverlay.classList.remove('active');
  filterToggleBtn.classList.remove('active');
  filterToggleBtn.setAttribute('aria-expanded', 'false');
  document.body.style.overflow="";
}
filterOverlay.onclick = (e) => {
  if (e.target === filterOverlay) filterCloseBtn.onclick();
}

// í•„í„°ë§ ë° í˜ì´ì§€
function filterRestaurants() {
  let list = Object.values(data).flat();
  if (currentCategory) list = data[currentCategory] || [];
  if (currentDietTags.length > 0)
    list = list.filter(r => currentDietTags.every(tag => r.tags.includes(tag)));
  if (currentPrice) {
    list = list.filter(r => {
      if (currentPrice === "under7k") return r.tags.includes("under10k");
      if (currentPrice === "under14k") return r.tags.includes("under10k");
      if (currentPrice === "under20k") return r.tags.includes("under20k");
      if (currentPrice === "over20k") return !r.tags.includes("under20k");
      return true;
    });
  }
  return list;
}

// ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ + í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ
function renderRestaurantList(page = 1) {
  if(currentView !== 'home') return;
  const list = filterRestaurants();
  const perPage = 10;
  const numPages = Math.max(1, Math.ceil(list.length/perPage));
  currentPage = Math.min(page, numPages);
  const startIdx = (currentPage-1)*perPage;
  const pageList = list.slice(startIdx, startIdx+perPage);

  restaurantListEl.innerHTML = '';
  if(pageList.length === 0){
    restaurantListEl.innerHTML = "<p style='text-align:center; margin-top:40px; color:#a08700;'>ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
    paginationEl.innerHTML = '';
    return;
  }
  pageList.forEach(r => {
    const li = document.createElement('li');
    li.className = 'card';
    li.tabIndex = 0;
    li.setAttribute('role','button');
    li.setAttribute('aria-label', `${r.name} - ${r.type} - ${r.menu}`);
    li.innerHTML = `
      <img class="thumb" src="${r.img || WHITE_IMG}" alt="${r.name} ì´ë¯¸ì§€" />
      <div class="info">
        <h3>${r.name}</h3>
        <p>${r.addr}</p>
        <p>${r.type} | ${r.menu}</p>
      </div>
    `;
    li.onclick = () => openDetail(r);
    li.onkeydown = (e) => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openDetail(r); } };
    restaurantListEl.appendChild(li);
  });
  // í˜ì´ì§€ë„¤ì´ì…˜
  paginationEl.innerHTML = '';
  if(numPages > 1) {
    for(let i=1;i<=numPages;i++){
      const btn = document.createElement('button');
      btn.textContent = i;
      if(i===currentPage) btn.classList.add('active');
      btn.onclick = ()=>{ renderRestaurantList(i); window.scrollTo({top:70, behavior:'smooth'});}
      paginationEl.appendChild(btn);
    }
  }
}

// ìƒì„¸ ì˜¤ë²„ë ˆì´
function increaseClick(name) {
  restaurantClicks[name] = (restaurantClicks[name]||0)+1;
  localStorage.setItem('restaurantClicks', JSON.stringify(restaurantClicks));
}
function openDetail(r) {
  if(filterOverlay.classList.contains('active')) filterCloseBtn.onclick(); // í•„í„° ë„ê¸° ìš°ì„ 
  detailTitle.textContent = r.name;
  detailImage.src = r.img || WHITE_IMG;
  detailImage.alt = r.name + ' ì‚¬ì§„';
  detailDescription.textContent = `ëŒ€í‘œ ë©”ë‰´: ${r.menu} (${r.type})`;
  detailLocation.textContent = `ìœ„ì¹˜: ${r.addr}`;
  detailTags.textContent = r.tags.length ? `íƒœê·¸: ${r.tags.join(', ')}` : "íƒœê·¸: ì—†ìŒ";
  detailExtra.textContent = "ìš´ì˜ì‹œê°„: 10:00 ~ 22:00 | ì˜ˆì•½, ì£¼ì°¨ ê°€ëŠ¥(ì˜ˆì‹œ)";
  detailOverlay.classList.add('active');
  detailCard.focus();
  increaseClick(r.name);
}
detailCloseBtn.onclick = () => {
  detailOverlay.classList.remove('active');
};
detailOverlay.onclick = (e) => {
  if (e.target === detailOverlay) detailCloseBtn.onclick();
};

// í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜
let lastHomeState = {cat:"",tags:[],price:"",page:1};
Object.entries(navButtons).forEach(([key, btn]) => {
  btn.onclick = () => {
    if(currentView === key) return;
    Object.values(navButtons).forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    Object.values(navButtons).forEach(b => b.removeAttribute('aria-current'));
    btn.setAttribute('aria-current','page');
    currentView = key;
    renderView();
  };
});

function renderView() {
  filterOverlay.classList.remove('active');
  detailOverlay.classList.remove('active');
  filterToggleBtn.classList.remove('active');
  filterToggleBtn.setAttribute('aria-expanded','false');
  document.body.style.overflow="";

  if(currentView === 'home'){
    filterToggleBtn.style.display = 'block';
    restaurantListEl.style.display = 'block';
    paginationEl.style.display = 'flex';

    renderRestaurantList(currentPage);
  } else {
    filterToggleBtn.style.display = 'none';
    restaurantListEl.innerHTML = '';
    paginationEl.style.display = 'none';

    let h2 = document.createElement('h2');
    h2.style.textAlign = 'left';
    h2.style.color = '#856300';
    h2.style.fontWeight = "900";
    h2.style.fontSize = "1.22em";
    h2.style.margin = "8px 0 20px 7px";

    if(currentView === 'community'){
      h2.textContent = 'ì»¤ë®¤ë‹ˆí‹°';
      restaurantListEl.appendChild(h2);
      [
        {title:"âœ¨ ê±´ëŒ€ ì €ë ´ ë§›ì§‘ ëª¨ìŒ",detail:"í•™ìƒë“¤ì´ ì¶”ì²œí•˜ëŠ” ê±´ëŒ€ ì €ë ´ ë§›ì§‘ ëª¨ìŒ!"},
        {title:"ğŸ¥¦ ë¹„ê±´ ì‹ë‹¹ ë¦¬ìŠ¤íŠ¸",detail:"ë¹„ê±´ ì‹ë‹¨ ê°€ëŠ¥í•œ ì‹ë‹¹ ì •ë¦¬"},
        {title:"ğŸ± ê°€ì„±ë¹„ ì ì‹¬ Top 5",detail:"ê°€ì„±ë¹„ ìµœê³  ì ì‹¬ ë©”ë‰´ ì¶”ì²œê¸€"}
      ].forEach(item => {
        let div = document.createElement('div');
        div.textContent = item.title;
        div.style.padding = '18px 9px';
        div.style.borderRadius = '12px';
        div.style.background='#fffde8';
        div.style.margin='0 0 14px 0';
        div.style.fontSize="1.07em";
        div.style.fontWeight="700";
        div.style.color="#755d00";
        div.style.boxShadow="0 2px 5px #f0e17b33";
        div.style.cursor = 'pointer';
        div.onclick = () => openSimpleDetail(item.title, item.detail);
        restaurantListEl.appendChild(div);
      });
    } else if(currentView === 'ranking'){
      h2.textContent = 'ì¸ê¸° ë­í‚¹';
      restaurantListEl.appendChild(h2);
      let ranked = Object.entries(restaurantClicks).sort((a, b) => b[1] - a[1]).slice(0, 10);
      if(ranked.length === 0){
        let p = document.createElement('p');
        p.textContent = 'ì•„ì§ ë­í‚¹ì´ ì—†ìŠµë‹ˆë‹¤.';
        p.style.textAlign = 'center';
        p.style.color = '#a08700';
        p.style.margin = '40px 0 0 0'; restaurantListEl.appendChild(p); return;
      }
      ranked.forEach(([name, count], idx) => {
        let div = document.createElement('div');
        div.style.display = 'flex';
        div.style.justifyContent = 'space-between';
        div.style.alignItems = 'center';
        div.style.padding = '15px 16px';
        div.style.marginBottom = '8px';
        div.style.borderRadius = '11px';
        div.style.background='#fff6c3';
        div.style.fontWeight='700';
        div.style.color='#6b4c00';
        div.style.fontSize='1.03em';
        div.tabIndex = 0;
        div.onclick = () => openByName(name);
        let left = document.createElement('span');
        left.innerHTML = idx===0?"ğŸ¥‡":idx===1?"ğŸ¥ˆ":idx===2?"ğŸ¥‰":(idx+1);
        left.style.marginRight="13px";
        let nm = document.createElement('span');
        nm.textContent = name; nm.style.marginRight="7px";
        let cnt = document.createElement('span'); cnt.textContent=`${count}íšŒ`; cnt.style.fontSize="0.95em";
        div.append(left, nm, cnt);
        restaurantListEl.appendChild(div);
      });
    } else if(currentView === 'notice'){
      h2.textContent = 'ê³µì§€ì‚¬í•­';
      restaurantListEl.appendChild(h2);
      [
        {title:"ë§›ì§‘ ì¶”ì²œ ë°›ì•„ìš”!",detail:"ë§›ì§‘ ì¶”ì²œ ì´ë²¤íŠ¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤."},
        {title:"ì´ë²ˆ ì£¼ í• ì¸ ì´ë²¤íŠ¸ ì§„í–‰ì¤‘",detail:"ì´ë²ˆ ì£¼ ì¼ë¶€ ì‹ë‹¹ 20% í• ì¸ ì¤‘!"},
        {title:"ì‹ ê·œ ì‹ë‹¹ ë“±ë¡ ì•ˆë‚´",detail:"ì‹ ê·œ ì‹ë‹¹ ë“±ë¡ ì•ˆë‚´ì…ë‹ˆë‹¤."}
      ].forEach(item => {
        let div = document.createElement('div');
        div.textContent = item.title;
        div.style.padding = '18px 9px';
        div.style.borderRadius = '12px';
        div.style.background='#fffde8';
        div.style.margin='0 0 14px 0';
        div.style.fontSize="1.07em";
        div.style.fontWeight="700";
        div.style.color="#755d00";
        div.style.boxShadow="0 2px 5px #f0e17b33";
        div.style.cursor = 'pointer';
        div.onclick = () => openSimpleDetail(item.title, item.detail);
        restaurantListEl.appendChild(div);
      });
    }
  }
}
// ì´ë¦„ìœ¼ë¡œ ì‹ë‹¹ ìƒì„¸ ì—´ê¸°
function openByName(name){
  const all = Object.values(data).flat();
  const r = all.find(x=>x.name === name);
  if(r) openDetail(r);
}
// ì»¤ë®¤ë‹ˆí‹°/ê³µì§€ ìƒì„¸
function openSimpleDetail(title, detail){
  if(filterOverlay.classList.contains('active')) filterCloseBtn.onclick();
  detailTitle.textContent = title;
  detailImage.src = "";
  detailImage.alt = "";
  detailDescription.textContent = detail;
  detailLocation.textContent = "";
  detailTags.textContent = "";
  detailExtra.textContent = "";
  detailOverlay.classList.add('active');
  detailCard.focus();
}

// í•„í„°, ìƒì„¸, ëª©ë¡, ë‚´ë¹„ ì´ˆê¸°í™”
createFilterButtons(filterRegionEl, regions, [], onRegionClick);
createFilterButtons(filterTagEl, dietTags, [], onDietClick);
createFilterButtons(filterPriceEl, priceRanges, [], onPriceClick);
updateFilterButtons();
renderRestaurantList();
renderView();
</script>
</body>
</html>
